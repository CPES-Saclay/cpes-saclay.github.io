---
import { getLangFromUrl, useTranslations } from '../i18n/index';

export interface Props {
  id?: string;
  numero?: string;
  annee: string;
  semestre: string;
  intitule: string;
  description: string;
  duree: string;
  heures: string;
  etablissement: string;
  mode: string;
  credits: string;
}

const { id, numero, annee, semestre, intitule, description, duree, heures, etablissement, mode, credits } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---


<div id={id} class="collapse collapse-arrow border border-base-200 rounded-box bg-base-300 mb-4">
  <input type="checkbox" />
  
  <div class="collapse-title flex items-center justify-between gap-4 p-4 font-medium">
    <span class="text-base text-base-content">{intitule}</span>
    <div class="mr-8">
      <span class="badge badge-success text-white">{etablissement}</span>
      <span class="badge badge-info text-white">{credits}</span>
    </div>
  </div>
  <div class="collapse-content bg-base-200">
    <div class="mb-4 pb-4 border-b border-base-300 text-sm text-base-content/80">
      {numero && <p class="mb-1"><strong class="font-medium">No.</strong> {numero}</p>}
      <p class="mb-1"><strong class="font-medium">{t('annee')} :</strong> {annee}</p>
      <p class="mb-1"><strong class="font-medium">{t('semestre')} :</strong> {semestre}</p>
      <p class="mb-1"><strong class="font-medium">{t('intitule')} :</strong> {intitule}</p>
    </div>

    <div class="mb-6">
      <h4 class="text-lg font-semibold mb-2 text-base-content">{t('descriptionCours')}</h4>
      <div class="prose max-w-none text-base-content/90" set:html={description} />
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 pt-3 border-t border-base-300 text-sm text-base-content/80">
      <p><strong class="font-medium">{t('duree')} :</strong> {duree}</p>
      <p><strong class="font-medium">{t('heuresCours')} :</strong> {heures}</p>
      <p><strong class="font-medium">{t('etablissement')} :</strong> {etablissement}</p>
      <p><strong class="font-medium">{t('modeEnseignement')} :</strong> {mode}</p>
      <p class="sm:col-span-2"><strong class="font-medium">{t('credits')} :</strong> {credits}</p>
    </div>
  </div>
</div>

<!-- Styling migrated to Tailwind + daisyUI classes -->

<script>
  // Automatically open course details when navigating via anchor link
  document.addEventListener('DOMContentLoaded', () => {
    const hash = window.location.hash;
    if (hash) {
      const element = document.querySelector(hash);
      if (element && element.tagName === 'DETAILS') {
        element.open = true;
      }
    }
  });

  // Handle clicks on anchor links to open details
  document.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
    if (target.tagName === 'A' && target.getAttribute('href')?.startsWith('#')) {
      const hash = target.getAttribute('href');
      if (hash) {
        const element = document.querySelector(hash);
        if (element && element.tagName === 'DETAILS') {
          setTimeout(() => {
            (element as HTMLDetailsElement).open = true;
          }, 100);
        }
      }
    }
  });
</script>
